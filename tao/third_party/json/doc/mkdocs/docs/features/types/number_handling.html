

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Number Handling &mdash; BladeDISC 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../../../../../../../../index.html">
                BladeDISC
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../../../../../../../../index.html">Docs</a></li>
        
      <li>Number Handling</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../../../../../../../../_sources/tao/third_party/json/doc/mkdocs/docs/features/types/number_handling.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../../../../../../../../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../README.html">BladeDISC Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#api-quickview">API QuickView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#setup-and-examples">Setup and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#tutorials-and-documents-for-developers">Tutorials and Documents for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#faq">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../README.html#contact-us">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/install_with_docker.html">Install with Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/install_with_docker.html#download-a-bladedisc-docker-image">Download a BladeDISC Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/install_with_docker.html#start-a-docker-container">Start a Docker Container</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/build_from_source.html">Build from Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/build_from_source.html#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/build_from_source.html#checkout-the-source">Checkout the Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/build_from_source.html#building-bladedisc-for-tensorflow-users">Building BladeDISC for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/build_from_source.html#building-bladedisc-for-pytorch-users">Building BladeDISC for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/quickstart.html#quickstart-for-tensorflow-users">Quickstart for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/quickstart.html#quickstart-for-pytorch-users">Quickstart for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/contribution.html">How to Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/contribution.html#local-development-environment">Local Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/contribution.html#submit-a-pull-request-to-bladedisc">Submit a Pull Request to BladeDISC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/developers/index.html">Documentation for Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/developers/pass_pipeline.html">Tutorial: A Walkthough of the BladeDISC Pass Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/developers/runtime_abstraction_layer.html">Runtime Abstraction Layer Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/developers/bladedisc_torch_overview.html">BladeDISC Torch Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/developers/torch_add_a_new_converter.html">Tutorial: How to add the support of a new Torch Op</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../docs/tutorials/index.html">Tutorials on Example Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/tutorials/tensorflow_inference_and_training.html">Use case of TensorFlow Inference and Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../../../docs/tutorials/torch_bert_inference.html">Use case of PyTorch Inference</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="number-handling">
<h1>Number Handling<a class="headerlink" href="#number-handling" title="Permalink to this headline">¶</a></h1>
<p>This document describes how the library is handling numbers.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>This section briefly summarizes how the JSON specification describes how numbers should be handled.</p>
<div class="section" id="json-number-syntax">
<h3>JSON number syntax<a class="headerlink" href="#json-number-syntax" title="Permalink to this headline">¶</a></h3>
<p>JSON defines the syntax of numbers as follows:</p>
<p>!!! quote “<a class="reference external" href="https://tools.ietf.org/html/rfc8259#section-6">RFC 8259</a>, Section 6”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">representation</span> <span class="n">of</span> <span class="n">numbers</span> <span class="ow">is</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">that</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">most</span>
<span class="n">programming</span> <span class="n">languages</span><span class="o">.</span>  <span class="n">A</span> <span class="n">number</span> <span class="ow">is</span> <span class="n">represented</span> <span class="ow">in</span> <span class="n">base</span> <span class="mi">10</span> <span class="n">using</span>
<span class="n">decimal</span> <span class="n">digits</span><span class="o">.</span>  <span class="n">It</span> <span class="n">contains</span> <span class="n">an</span> <span class="n">integer</span> <span class="n">component</span> <span class="n">that</span> <span class="n">may</span> <span class="n">be</span>
<span class="n">prefixed</span> <span class="k">with</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">minus</span> <span class="n">sign</span><span class="p">,</span> <span class="n">which</span> <span class="n">may</span> <span class="n">be</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">a</span>
<span class="n">fraction</span> <span class="n">part</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">an</span> <span class="n">exponent</span> <span class="n">part</span><span class="o">.</span>  <span class="n">Leading</span> <span class="n">zeros</span> <span class="n">are</span> <span class="ow">not</span>
<span class="n">allowed</span><span class="o">.</span>

<span class="n">A</span> <span class="n">fraction</span> <span class="n">part</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">decimal</span> <span class="n">point</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">digits</span><span class="o">.</span>

<span class="n">An</span> <span class="n">exponent</span> <span class="n">part</span> <span class="n">begins</span> <span class="k">with</span> <span class="n">the</span> <span class="n">letter</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">uppercase</span> <span class="ow">or</span> <span class="n">lowercase</span><span class="p">,</span>
<span class="n">which</span> <span class="n">may</span> <span class="n">be</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">a</span> <span class="n">plus</span> <span class="ow">or</span> <span class="n">minus</span> <span class="n">sign</span><span class="o">.</span>  <span class="n">The</span> <span class="n">E</span> <span class="ow">and</span> <span class="n">optional</span>
<span class="n">sign</span> <span class="n">are</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">digits</span><span class="o">.</span>
</pre></div>
</div>
<p>The following railroad diagram from <a class="reference external" href="https://json.org">json.org</a> visualizes the number syntax:</p>
<p><img alt="Syntax for JSON numbers" src="tao/third_party/json/doc/mkdocs/docs/images/json_syntax_number.png" /></p>
</div>
<div class="section" id="number-interoperability">
<h3>Number interoperability<a class="headerlink" href="#number-interoperability" title="Permalink to this headline">¶</a></h3>
<p>On number interoperability, the following remarks are made:</p>
<p>!!! quote “<a class="reference external" href="https://tools.ietf.org/html/rfc8259#section-6">RFC 8259</a>, Section 6”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This specification allows implementations to set limits on the range
and precision of numbers accepted.  Since software that implements
IEEE 754 binary64 (double precision) numbers [IEEE754] is generally
available and widely used, good interoperability can be achieved by
implementations that expect no more precision or range than these
provide, in the sense that implementations will approximate JSON
numbers within the expected precision.  A JSON number such as 1E400
or 3.141592653589793238462643383279 may indicate potential
interoperability problems, since it suggests that the software that
created it expects receiving software to have greater capabilities
for numeric magnitude and precision than is widely available.

Note that when such software is used, numbers that are integers and
are in the range $[-2^{53}+1, 2^{53}-1]$ are interoperable in the
sense that implementations will agree exactly on their numeric
values.
</pre></div>
</div>
</div>
</div>
<div class="section" id="library-implementation">
<h2>Library implementation<a class="headerlink" href="#library-implementation" title="Permalink to this headline">¶</a></h2>
<p>This section describes how the above number specification is implemented by this library.</p>
<div class="section" id="number-storage">
<h3>Number storage<a class="headerlink" href="#number-storage" title="Permalink to this headline">¶</a></h3>
<p>In the default <a class="reference internal" href="../../api/json.html"><span class="doc">json</span></a> type, numbers are stored as <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">std::uint64_t</span></code>, <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">std::int64_t</span></code>, and
<code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">double</span></code>,  respectively. Thereby, <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">std::uint64_t</span></code> and <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">std::int64_t</span></code> are used only if they can store the
number without loss of  precision. If this is impossible (e.g., if the number is too large), the number is stored as
<code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">double</span></code>.</p>
<p>!!! info “Notes”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- Numbers with a decimal digit or scientific notation are always stored as `#!c double`.
- The number types can be changed, see [Template number types](#template-number-types). 
- As of version 3.9.1, the conversion is realized by
  [`std::strtoull`](https://en.cppreference.com/w/cpp/string/byte/strtoul),
  [`std::strtoll`](https://en.cppreference.com/w/cpp/string/byte/strtol), and
  [`std::strtod`](https://en.cppreference.com/w/cpp/string/byte/strtof), respectively.
</pre></div>
</div>
<p>!!! example “Examples”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- Integer `#!c -12345678912345789123456789` is smaller than `#!c INT64_MIN` and will be stored as floating-point
  number `#!c -1.2345678912345788e+25`.
- Integer `#!c 1E3` will be stored as floating-point number `#!c 1000.0`.
</pre></div>
</div>
</div>
<div class="section" id="number-limits">
<h3>Number limits<a class="headerlink" href="#number-limits" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Any 64 bit signed or unsigned integer can be stored without loss of precision.</p></li>
<li><p>Numbers exceeding the limits of <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">double</span></code> (i.e., numbers that after conversion via
<a class="reference external" href="https://en.cppreference.com/w/cpp/string/byte/strtof"><code class="docutils literal notranslate"><span class="pre">std::strtod</span></code></a> are not satisfying
<a class="reference external" href="https://en.cppreference.com/w/cpp/numeric/math/isfinite"><code class="docutils literal notranslate"><span class="pre">std::isfinite</span></code></a> such as <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">1E400</span></code>) will throw exception
json.exception.out_of_range.406 during parsing.</p></li>
<li><p>Floating-point numbers are rounded to the next number representable as <code class="docutils literal notranslate"><span class="pre">double</span></code>. For instance
<code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">3.141592653589793238462643383279</span></code> is stored as <a class="reference external" href="https://float.exposed/0x400921fb54442d18"><code class="docutils literal notranslate"><span class="pre">0x400921fb54442d18</span></code></a>.
This is the same behavior as the code <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">double</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">3.141592653589793238462643383279;</span></code>.</p></li>
</ul>
<p>!!! success “Interoperability”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- The library interoperable with respect to the specification, because its supported range $[-2^{63}, 2^{64}-1]$ is
  larger than the described range $[-2^{53}+1, 2^{53}-1]$.
- All integers outside the range $[-2^{63}, 2^{64}-1]$, as well as floating-point numbers are stored as `double`.
  This also concurs with the specification above.
</pre></div>
</div>
</div>
<div class="section" id="zeros">
<h3>Zeros<a class="headerlink" href="#zeros" title="Permalink to this headline">¶</a></h3>
<p>The JSON number grammar allows for different ways to express zero, and this library will store zeros differently:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Literal</th>
<th>Stored value and type</th>
<th>Serialization</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>#!c std::uint64_t(0)</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>-0</code></td>
<td><code>#!c std::int64_t(0)</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>0.0</code></td>
<td><code>#!c double(0.0)</code></td>
<td><code>0.0</code></td>
</tr>
<tr>
<td><code>-0.0</code></td>
<td><code>#!c double(-0.0)</code></td>
<td><code>-0.0</code></td>
</tr>
<tr>
<td><code>0E0</code></td>
<td><code>#!c double(0.0)</code></td>
<td><code>0.0</code></td>
</tr>
<tr>
<td><code>-0E0</code></td>
<td><code>#!c double(-0.0)</code></td>
<td><code>-0.0</code></td>
</tr>
</tbody>
</table><p>That is, <code class="docutils literal notranslate"><span class="pre">-0</span></code> is stored as a signed integer, but the serialization does not reproduce the <code class="docutils literal notranslate"><span class="pre">-</span></code>.</p>
</div>
<div class="section" id="number-serialization">
<h3>Number serialization<a class="headerlink" href="#number-serialization" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Integer numbers are serialized as is; that is, no scientific notation is used.</p></li>
<li><p>Floating-point numbers are serialized as specified by the <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">%g</span></code> printf modifier with
<a class="reference external" href="https://en.cppreference.com/w/cpp/types/numeric_limits/max_digits10"><code class="docutils literal notranslate"><span class="pre">std::numeric_limits&lt;double&gt;::max_digits10</span></code></a>
significant digits). The rationale is to use the shortest representation while still allow round-tripping.</p></li>
</ul>
<p>!!! hint “Notes regarding precision of floating-point numbers”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>As described above, floating-point numbers are rounded to the nearest double and serialized with the shortest
representation to allow round-tripping. This can yield confusing examples:

- The serialization can have fewer decimal places than the input: `#!c 2555.5599999999999` will be serialized as
  `#!c 2555.56`. The reverse can also be true.
- The serialization can be in scientific notation even if the input is not: `#!c 0.0000972439793401814` will be 
  serialized as `#!c 9.72439793401814e-05`. The reverse can also be true: `#!c 12345E-5` will be serialized as
  `#!c 0.12345`.
- Conversions from `#!c float` to `#!c double` can also introduce rounding errors:
    ```cpp
    float f = 0.3;
    json j = f;
    std::cout &lt;&lt; j &lt;&lt; &#39;\n&#39;;
    ```
    yields `#!c 0.30000001192092896`.

All examples here can be reproduced by passing the original double value to

```cpp
std::printf(&quot;%.*g\n&quot;, std::numeric_limits&lt;double&gt;::max_digits10, double_value);
```
</pre></div>
</div>
<div class="section" id="nan-handling">
<h4>NaN handling<a class="headerlink" href="#nan-handling" title="Permalink to this headline">¶</a></h4>
<p>NaN (not-a-number) cannot be expressed with the number syntax described above and are in fact explicitly excluded:</p>
<p>!!! quote “<a class="reference external" href="https://tools.ietf.org/html/rfc8259#section-6">RFC 8259</a>, Section 6”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Numeric</span> <span class="n">values</span> <span class="n">that</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">represented</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">grammar</span> <span class="n">below</span> <span class="p">(</span><span class="n">such</span>
<span class="k">as</span> <span class="n">Infinity</span> <span class="ow">and</span> <span class="n">NaN</span><span class="p">)</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">permitted</span><span class="o">.</span>
</pre></div>
</div>
<p>That is, there is no way to <em>parse</em> a NaN value. However, NaN values can be stored in a JSON value by assignment.</p>
<p>This library serializes NaN values  as <code class="docutils literal notranslate"><span class="pre">#!js</span> <span class="pre">null</span></code>. This corresponds to the behavior of JavaScript’s
<a class="reference external" href="https://www.w3schools.com/js/js_json_stringify.asp"><code class="docutils literal notranslate"><span class="pre">JSON.stringify</span></code></a> function.</p>
<p>!!! example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The following example shows how a NaN value is stored in a `json` value.

```cpp
int main()
{
    double val = std::numeric_limits&lt;double&gt;::quiet_NaN();
    std::cout &lt;&lt; &quot;val=&quot; &lt;&lt; val &lt;&lt; std::endl;
    json j = val;
    std::cout &lt;&lt; &quot;j=&quot; &lt;&lt; j.dump() &lt;&lt; std::endl;
    val = j;
    std::cout &lt;&lt; &quot;val=&quot; &lt;&lt; val &lt;&lt; std::endl;
}
```

output:

```
val=nan
j=null
val=nan
```
</pre></div>
</div>
</div>
</div>
<div class="section" id="number-comparison">
<h3>Number comparison<a class="headerlink" href="#number-comparison" title="Permalink to this headline">¶</a></h3>
<p>Floating-point inside JSON values numbers are compared with <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">json::number_float_t::operator==</span></code> which is
<code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">double::operator==</span></code> by default.</p>
<p>!!! example “Alternative comparison functions”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>To compare floating-point while respecting an epsilon, an alternative
[comparison function](https://github.com/mariokonrad/marnav/blob/master/include/marnav/math/floatingpoint.hpp#L34-#L39)
could be used, for instance

```cpp
template&lt;typename T, typename = typename std::enable_if&lt;std::is_floating_point&lt;T&gt;::value, T&gt;::type&gt;
inline bool is_same(T a, T b, T epsilon = std::numeric_limits&lt;T&gt;::epsilon()) noexcept
{
    return std::abs(a - b) &lt;= epsilon;
}
```
Or you can self-define an operator equal function like this:

```cpp
bool my_equal(const_reference lhs, const_reference rhs)
{
    const auto lhs_type lhs.type();
    const auto rhs_type rhs.type();
    if (lhs_type == rhs_type)
    {
        switch(lhs_type)
        {
            // self_defined case
            case value_t::number_float:
                return std::abs(lhs - rhs) &lt;= std::numeric_limits&lt;float&gt;::epsilon();
    
            // other cases remain the same with the original
            ...
        }
    }
    ...
}
```

(see [#703](https://github.com/nlohmann/json/issues/703) for more information.)
</pre></div>
</div>
<p>!!! note</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NaN</span> <span class="n">values</span> <span class="n">never</span> <span class="n">compare</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">themselves</span> <span class="ow">or</span> <span class="n">to</span> <span class="n">other</span> <span class="n">NaN</span> <span class="n">values</span><span class="o">.</span> <span class="n">See</span> <span class="p">[</span><span class="c1">#514](https://github.com/nlohmann/json/issues/514).</span>
</pre></div>
</div>
</div>
<div class="section" id="number-conversion">
<h3>Number conversion<a class="headerlink" href="#number-conversion" title="Permalink to this headline">¶</a></h3>
<p>Just like the C++ language itself, the <code class="docutils literal notranslate"><span class="pre">get</span></code> family of functions allows conversions between unsigned and signed
integers, and  between integers and floating-point values to integers. This behavior may be surprising.</p>
<p>!!! warning “Unconditional number conversions”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```cpp hl_lines=&quot;3&quot;
double d = 42.3;                          // non-integer double value 42.3
json jd = d;                              // stores double value 42.3
std::int64_t i = jd.get&lt;std::int64_t&gt;();  // now i==42; no warning or error is produced
```

Note the last line with throw a [`json.exception.type_error.302`](../../home/exceptions.md#jsonexceptiontype_error302)
exception if `jd` is not a numerical type, for instance a string.
</pre></div>
</div>
<p>The rationale is twofold:</p>
<ol class="simple">
<li><p>JSON does not define a number type or precision (see <a class="reference external" href="above">#json-specification</a>).</p></li>
<li><p>C++ also allows to silently convert between number types.</p></li>
</ol>
<p>!!! success “Conditional number conversion”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The code above can be solved by explicitly checking the nature of the value with members such as
[`is_number_integer()`](../../api/basic_json/is_number_integer.md) or
[`is_number_unsigned()`](../../api/basic_json/is_number_unsigned.md):

```cpp hl_lines=&quot;2&quot;
// check if jd is really integer-valued
if (jd.is_number_integer())
{
    // if so, do the conversion and use i
    std::int64_t i = jd.get&lt;std::int64_t&gt;();
    // ...
}
else
{
    // otherwise, take appropriate action
    // ...
}
```

Note this approach also has the advantage that it can react on non-numerical JSON value types such as strings.

(Example taken from [#777](https://github.com/nlohmann/json/issues/777#issuecomment-459968458).)
</pre></div>
</div>
</div>
<div class="section" id="determine-number-types">
<h3>Determine number types<a class="headerlink" href="#determine-number-types" title="Permalink to this headline">¶</a></h3>
<p>As the example in <a class="reference external" href="#number_conversion">Number conversion</a> shows, there are different functions to determine the type of
the stored number:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/basic_json/is_number.html"><span class="doc">is_number()</span></a> returns <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">true</span></code> for any number type</p></li>
<li><p><a class="reference internal" href="../../api/basic_json/is_number_integer.html"><span class="doc">is_number_integer()</span></a> returns <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">true</span></code> for signed and unsigned integers</p></li>
<li><p><a class="reference internal" href="../../api/basic_json/is_number_unsigned.html"><span class="doc">is_number_unsigned()</span></a> returns <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">true</span></code> for unsigned integers only</p></li>
<li><p><a class="reference internal" href="../../api/basic_json/is_number_float.html"><span class="doc">is_number_float()</span></a> returns <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">true</span></code> for floating-point numbers</p></li>
<li><p><a class="reference internal" href="../../api/basic_json/type_name.html"><span class="doc">type_name()</span></a> returns <code class="docutils literal notranslate"><span class="pre">#!c</span> <span class="pre">&quot;number&quot;</span></code> for any number type</p></li>
<li><p><a class="reference internal" href="../../api/basic_json/type.html"><span class="doc">type()</span></a> returns an different enumerator of
<a class="reference internal" href="../../api/basic_json/value_t.html"><span class="doc">value_t</span></a> for all number types</p></li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>function</th>
<th>unsigned integer</th>
<th>signed integer</th>
<th>floating-point</th>
<th>string</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../../api/basic_json/is_number.md"><code>is_number()</code></a></td>
<td><code>#!c true</code></td>
<td><code>#!c true</code></td>
<td><code>#!c true</code></td>
<td><code>#!c false</code></td>
</tr>
<tr>
<td><a href="../../api/basic_json/is_number_integer.md"><code>is_number_integer()</code></a></td>
<td><code>#!c true</code></td>
<td><code>#!c true</code></td>
<td><code>#!c false</code></td>
<td><code>#!c false</code></td>
</tr>
<tr>
<td><a href="../../api/basic_json/is_number_unsigned.md"><code>is_number_unsigned()</code></a></td>
<td><code>#!c true</code></td>
<td><code>#!c false</code></td>
<td><code>#!c false</code></td>
<td><code>#!c false</code></td>
</tr>
<tr>
<td><a href="../../api/basic_json/is_number_float.md"><code>is_number_float()</code></a></td>
<td><code>#!c false</code></td>
<td><code>#!c false</code></td>
<td><code>#!c true</code></td>
<td><code>#!c false</code></td>
</tr>
<tr>
<td><a href="../../api/basic_json/type_name.md"><code>type_name()</code></a></td>
<td><code>#!c "number"</code></td>
<td><code>#!c "number"</code></td>
<td><code>#!c "number"</code></td>
<td><code>#!c "string"</code></td>
</tr>
<tr>
<td><a href="../../api/basic_json/type.md"><code>type()</code></a></td>
<td><code>number_unsigned</code></td>
<td><code>number_integer</code></td>
<td><code>number_float</code></td>
<td><code>string</code></td>
</tr>
</tbody>
</table></div>
<div class="section" id="template-number-types">
<h3>Template number types<a class="headerlink" href="#template-number-types" title="Permalink to this headline">¶</a></h3>
<p>The number types can be changed with template parameters.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>position</th>
<th>number type</th>
<th>default type</th>
<th>possible values</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>signed integers</td>
<td><code>#!c std::int64_t</code></td>
<td><code>#!c std::int32_t</code>, <code>#!c std::int16_t</code>, etc.</td>
</tr>
<tr>
<td>6</td>
<td>unsigned integers</td>
<td><code>#!c std::uint64_t</code></td>
<td><code>#!c std::uint32_t</code>, <code>#!c std::uint16_t</code>, etc.</td>
</tr>
<tr>
<td>7</td>
<td>floating-point</td>
<td><code>#!c double</code></td>
<td><code>#!c float</code>, <code>#!c long double</code></td>
</tr>
</tbody>
</table><p>!!! info “Constraints on number types”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- The type for signed integers must be convertible from `#!c long long`. The type for floating-point numbers is used
  in case of overflow.
- The type for unsigned integers must be convertible from `#!c unsigned long long`.  The type for floating-point
  numbers is used in case of overflow.
- The types for signed and unsigned integers must be distinct, see
  [#2573](https://github.com/nlohmann/json/issues/2573).
- Only `#!c double`, `#!c float`, and `#!c long double` are supported for floating-point numbers.
</pre></div>
</div>
<p>!!! example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>A `basic_json` type that uses `#!c long double` as floating-point type.

```cpp hl_lines=&quot;2&quot;
using json_ld = nlohmann::basic_json&lt;std::map, std::vector, std::string, bool,
                                     std::int64_t, std::uint64_t, long double&gt;;
```

Note values should then be parsed with `json_ld::parse` rather than `json::parse` as the latter would parse
floating-point values to `#!c double` before then converting them to `#!c long double`.
</pre></div>
</div>
</div>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../../../../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../../../../../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright bladedisc-dev@list.alibaba-inc.com.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.
        </div>
    </div>  

</body>
</html>